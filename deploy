#!/bin/bash

# script/server: produce jekyll site of the manual

set -e

cd "$(dirname "$0")/.."

remote=$(git config remote.origin.url)
git config --global user.email "$GH_EMAIL" > /dev/null 2>&1
git config --global user.name "$GH_NAME" > /dev/null 2>&1
#git init
#git remote add --fetch origin "$remote"

rm -rf vendor
rm .ruby-version
mv onlyCICD.pdf onlyCICDtemp.pdf
mv fullCICD.pdf fullCICDtemp.pdf
mv GH4D.pdf GH4Dtemp.pdf
mv fullcicd/ fullcicdtemp/
mv onlycicd/ onlycicdtemp/
mv GH4D/ GH4Dtemp/

git checkout gh-pages --force
git pull origin gh-pages --rebase
git clean -fx node_modules
git clean -fx _book

git status

rm -rf onlyCICD.pdf
rm -rf fullCICD.pdf
rm -rf GH4D.pdf
rm -rf fullcicd/
rm -rf onlycicd/
rm -rf GH4D/
mv onlyCICDtemp.pdf onlyCICD.pdf
mv fullCICDtemp.pdf fullCICD.pdf
mv GH4Dtemp.pdf GH4D.pdf
mv onlycicdtemp/ onlycicd/
mv fullcicdtemp/ fullcicd/
mv GH4Dtemp/ GH4d/

git add .
git commit -m "update book [ci skip]"

#bundle install

echo -e "\n\n"
echo "==> Deploying..."
echo -e "\n\n"

git push
